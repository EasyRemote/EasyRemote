# Author: Silan Hu (silan.hu@u.nus.edu)

.PHONY: help server node client

PORT ?= 8084
GATEWAY ?= 127.0.0.1:$(PORT)
USER_ID ?= demo-user
NODE_ID ?= user-device-$(USER_ID)
TARGET_USER_ID ?= $(USER_ID)
TARGET_USER_NODE_ID ?=
PHOTO_SOURCE ?= front-camera
PHOTO_RESOLUTION ?= 1920x1080
CAMERA_SCAN_MAX_INDEX ?= 4
CAMERA_FRONT_INDEX ?= 0
CAMERA_REAR_INDEX ?= 1
CAMERA_CANDIDATES ?= 0,1,2,3

help:
	@echo "Targets: server | node | client"
	@echo "Variables: PORT=$(PORT) GATEWAY=$(GATEWAY)"
	@echo "           USER_ID=$(USER_ID) NODE_ID=$(NODE_ID)"
	@echo "           TARGET_USER_ID=$(TARGET_USER_ID) TARGET_USER_NODE_ID=$(TARGET_USER_NODE_ID)"
	@echo "           PHOTO_SOURCE=$(PHOTO_SOURCE) PHOTO_RESOLUTION=$(PHOTO_RESOLUTION) CAMERA_SCAN_MAX_INDEX=$(CAMERA_SCAN_MAX_INDEX)"
	@echo "           CAMERA_FRONT_INDEX=$(CAMERA_FRONT_INDEX) CAMERA_REAR_INDEX=$(CAMERA_REAR_INDEX)"
	@echo "           CAMERA_CANDIDATES=$(CAMERA_CANDIDATES)"

server:
	EASYREMOTE_PORT=$(PORT) uv run python server.py

node:
	EASYREMOTE_GATEWAY_ADDRESS=$(GATEWAY) USER_ID=$(USER_ID) NODE_ID=$(NODE_ID) CAMERA_FRONT_INDEX=$(CAMERA_FRONT_INDEX) CAMERA_REAR_INDEX=$(CAMERA_REAR_INDEX) CAMERA_CANDIDATES=$(CAMERA_CANDIDATES) uv run python user_device_node.py

client:
	EASYREMOTE_GATEWAY_ADDRESS=$(GATEWAY) TARGET_USER_ID=$(TARGET_USER_ID) TARGET_USER_NODE_ID=$(TARGET_USER_NODE_ID) PHOTO_SOURCE=$(PHOTO_SOURCE) PHOTO_RESOLUTION=$(PHOTO_RESOLUTION) CAMERA_SCAN_MAX_INDEX=$(CAMERA_SCAN_MAX_INDEX) uv run python agent_client.py
